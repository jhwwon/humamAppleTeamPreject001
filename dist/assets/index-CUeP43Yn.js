const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/nativePlayer-B6_v94je-CrKE6Yq1.js","assets/preload-helper-BlTxHScW.js","assets/basePlayer-D_BzNCZH-ZnYs-9ht.js","assets/browserPlayer-BlasGuEd-DlaYchVQ.js","assets/shakaPlayer-CBJaoKee-BCe9Vyf0.js","assets/_commonjsHelpers-DaMA6jEr-DwXtFsJ3.js"])))=>i.map(i=>d[i]);
import{_ as D}from"./preload-helper-BlTxHScW.js";let x=Object.freeze({apiUrl:"https://api.tidal.com/v1",desiredVolumeLevel:1,gatherEvents:!0,loudnessNormalizationMode:"ALBUM",outputDevicesEnabled:!1,streamingWifiAudioQuality:"LOW"});function O(t){return x[t]}function N(t){return x=Object.freeze({...x,...t}),Object.keys(t).forEach(e=>{const r=e;se.dispatchEvent(new CustomEvent(r,{detail:t[r]}))}),x}const se=new EventTarget;class ie{#e;#r=!1;#s;#t;constructor(e){this.#t=new URL(e),this.synchronize()}now(e=Date.now()){return!this.#s||!this.#e?(console.warn("TrueTime is not yet synchronized"),e):this.#s+(e-this.#e)}async synchronize(){if(!(this.#e&&Math.abs(Date.now()-this.#e)<36e5||this.#r)){this.#r=!0;try{const e=await fetch(this.#t);e.ok&&e.headers.has("date")&&(this.#s=new Date(e.headers.get("date")).getTime(),this.#e=Date.now())}catch(e){console.error(e)}this.#r=!1}}timestamp(e,r){let i;if(r){if(i=performance.getEntriesByName(e).find(n=>"detail"in n&&n.detail===r),!i)throw new ReferenceError(`There is no performance entry named "${e}" with detail "${r}"`)}else i=performance.getEntriesByName(e).pop();return i?i.startTime:void 0}}const b=new ie("https://api.tidal.com/v1/ping"),ne=(t,e,r)=>{for(const i of t){const n=i.addedNodes[0];i.type==="childList"&&n.id===e&&r()}};function ae(){const t=document.getElementById("tidal-player-root");if(!t)return Promise.reject("No player root");if("video-one"in t.children)return Promise.resolve();const e=[];return"video-one"in t.children||e.push(new Promise(r=>{new MutationObserver(i=>ne(i,"video-one",r)).observe(t,{childList:!0})})),Promise.all(e)}const k=document.createElement("video"),oe=t=>{t.setAttribute("crossorigin","anonymous"),t.setAttribute("playsinline","playsinline")};oe(k);k.id="video-one";const A="tidal-player-root";function ce(){let t=document.getElementById(A);if(!t){const e=document.createElement("template");e.id=A,document.body.appendChild(e),t=document.getElementById(A)}return de()}function de(){const t=document.getElementById(A);return t&&(k.id in t.children||t.appendChild(k)),ae()}function ue(){return new Promise(t=>document.addEventListener("click",()=>{k.readyState===HTMLMediaElement.HAVE_NOTHING&&!k.src&&k.load(),t()},{once:!0}))}function le(t){return new Promise(e=>setTimeout(()=>e(),t))}function he(t,e){return new Promise(r=>{t.addEventListener(e,i=>r(i),!1)})}class me extends EventTarget{#e;hasEventSender(){return!!this.#e}set eventSender(e){this.#e=e}get eventSender(){return this.#e}}class pe extends EventTarget{#e;async dispatchAuthorized(){const e=await this.#e.getCredentials();e?.token?this.dispatchEvent(new CustomEvent("authorized",{detail:{credentials:e}})):this.dispatchEvent(new CustomEvent("unauthenticated",{detail:{credentials:e}}))}set credentialsProvider(e){this.#e=e,this.dispatchAuthorized().catch(console.error),this.#e.bus(r=>{r.detail.type==="CredentialsUpdatedMessage"?this.dispatchAuthorized().catch(console.error):console.warn("Unhandled event from credentials provider: ",r)})}get credentialsProvider(){return this.#e}}class B extends Error{errorCode=null;errorId=null;referenceId;constructor(e,r,i){super(`${e}: ${r} (${i})`),this.errorId=e,this.errorCode=r,this.referenceId=i}toJSON(){return{errorCode:this.errorCode,errorId:this.errorId,referenceId:this.referenceId}}toString(){return JSON.stringify(this.toJSON())}}async function I(){if(M.credentialsProvider){const t=await M.credentialsProvider.getCredentials();return!!(t.token&&t.userId)}return await he(M,"authorized"),I()}const M=new pe,H=new me;async function ge(){const t=await I(),e=async()=>{const{Pushkin:r}=await Promise.resolve().then(()=>ct);return r.refresh()};if(t){N({gatherEvents:!0});try{await Promise.all([e()])}catch(r){console.error(r)}}else N({gatherEvents:!1})}function be(){N({gatherEvents:!0})}M.addEventListener("authorized",()=>{ge().then().catch(console.error)});M.addEventListener("unauthenticated",()=>{be()});async function W(){return M.credentialsProvider?(await M.credentialsProvider.getCredentials()).token??null:null}class fe extends EventTarget{dispatchError(e){this.dispatchEvent(new CustomEvent("error",{detail:e.toJSON()}))}}const v=new fe,F={BTS:"application/vnd.tidal.bts",DASH:"application/dash+xml",EMU:"application/vnd.tidal.emu",HLS:"application/vnd.apple.mpegurl"};class ye{#e=new Map;#r=new Map;#s=new Map;#t=new Map;clone(e,r){const i=this.getMediaProductTransition(e),n=this.getStreamInfo(e),a=this.getPlaybackInfo(e);if(!i||!n||!a)throw new Error(`Cannot clone ${e}. Missing mediaProductTransition or streamInfo.`);this.saveMediaProductTransition(r,{...i,playbackContext:{...i.playbackContext,playbackSessionId:r}}),this.saveStreamInfo(r,{...n,streamingSessionId:r}),this.savePlaybackInfo(r,{...a,streamingSessionId:r})}deleteMediaProductTransition(e){this.#e.delete(e)}deleteSession(e){this.deleteMediaProductTransition(e),this.#r.delete(e),this.#s.delete(e),this.deleteStreamInfo(e)}deleteStartedStreamInfo(e){this.#s.delete(e)}deleteStreamInfo(e){this.#t.delete(e)}getMediaProductTransition(e){return e?this.#e.get(e):void 0}getPlaybackInfo(e){return e?this.#r.get(e):void 0}getStreamInfo(e){return e?this.#t.get(e):void 0}hasMediaProductTransition(e){return this.#e.has(e)}hasPlaybackInfo(e){return this.#r.has(e)}hasStartedStreamInfo(e){return this.#s.has(e)}hasStreamInfo(e){return this.#t.has(e)}overwriteDuration(e,r){const i=this.#e.get(e);i&&(i.playbackContext={...i.playbackContext,actualDuration:r},this.saveMediaProductTransition(e,i))}saveMediaProductTransition(e,r){this.#e.set(e,r)}savePlaybackInfo(e,r){this.#r.set(e,r)}saveStreamInfo(e,r){this.#t.set(e,r)}setStartedStreamInfo(e){return this.#s.set(e,!0)}}const G=new ye;class we{activePlayer;preloadPlayer;get preloadedMediaProduct(){return G.getMediaProductTransition(this.preloadedStreamingSessionId)?.mediaProduct??void 0}get preloadedStreamingSessionId(){return this.preloadPlayer?.preloadedStreamingSessionId??void 0}}const g=new we;let ve;const Se=[{itemTypes:["track","video"],player:"shaka",qualities:["HIGH","LOSSLESS","LOW","HI_RES_LOSSLESS"]}];let R=Se;const f={browser:void 0,native:void 0,shaka:void 0};async function Me(){await Promise.all(R.map(t=>{const e=f[t.player];return e?e.reset():Promise.resolve()})),g.activePlayer=void 0,g.preloadPlayer=void 0}function ke(t){t.name!=="nativePlayer"&&f.native&&f.native.abandon(),g.activePlayer=t}function Pe(){v.removeEventListener("ended",ve)}async function Ee(){const{default:t}=await D(async()=>{const{default:e}=await import("./nativePlayer-B6_v94je-CrKE6Yq1.js");return{default:e}},__vite__mapDeps([0,1,2]));return f.native||(f.native=new t),f.native}async function Ie(){const{default:t}=await D(async()=>{const{default:e}=await import("./browserPlayer-BlasGuEd-DlaYchVQ.js");return{default:e}},__vite__mapDeps([3,2,1]));return f.browser||(f.browser=new t),f.browser}async function Te(){const{default:t}=await D(async()=>{const{default:e}=await import("./shakaPlayer-CBJaoKee-BCe9Vyf0.js");return{default:e}},__vite__mapDeps([4,1,5,2]));return f.shaka||(f.shaka=new t),f.shaka}async function _e(t,e,r){const i=R.filter(a=>a.itemTypes.includes(t)).filter(a=>t==="track"&&a.qualities&&e?a.qualities.includes(e):!0);i.length===0&&console.error(`No player found to handle audio quality "${String(e)}" for product type "${t}" in player config: `,R);let{player:n}=i[0];switch((r===F.DASH||r===F.HLS)&&n==="native"&&(n="shaka"),n){case"browser":return Ie();case"native":return Ee();case"shaka":return Te();default:throw new Error("No player found.")}}class Fe{#e;constructor(){this.#e=new Map}async#r(e,r){const i=new TextEncoder().encode(`${e}-${r}`),n=await crypto.subtle.digest("SHA-1",i);return Array.from(new Uint8Array(n)).map(a=>a.toString(16).padStart(2,"0")).join("")}async delete({name:e,streamingSessionId:r}){const i=await this.#r(r,e);this.#e.delete(i)}async get({name:e,streamingSessionId:r}){const i=await this.#r(r,e);return this.#e.get(i)}async put(e){const r=await this.#r(e.streamingSessionId,e.name);this.#e.set(r,e)}}const z=new Fe;async function T(t,e){return O("gatherEvents")?async r=>{try{const i=await z.get({name:t,streamingSessionId:r.streamingSessionId}),n=Object.assign({},e,i?i.payload:{},r);for(const a of Object.keys(r)){const o=a;Array.isArray(r[o])&&(n[o]=[...e[o]||[],...i&&i.payload[o]||[],...r[o]||[]])}return await z.put({name:t,payload:n,streamingSessionId:r.streamingSessionId}),{name:t,payload:n,streamingSessionId:r.streamingSessionId}}catch(i){console.error(i)}}:r=>Promise.resolve(void 0)}const xe={endReason:"COMPLETE",endTimestamp:0,errorCode:null,errorMessage:null,startTimestamp:0,streamingSessionId:""},Ae=await T("drm_license_fetch",xe);function pt(t){return Ae(t)}const Be={endReason:"COMPLETE",endTimestamp:0,errorCode:null,errorMessage:null,startTimestamp:0,streamingSessionId:""},Oe=await T("playback_info_fetch",Be);function L(t){return Oe(t)}function gt(t){switch(t){case"bluetooth":return"BLUETOOTH";case"builtIn":return"BUILT_IN";case"displayPort":return"DISPLAY_PORT";case"hdmi":return"HDMI";case"systemDefault":return"SYSTEM_DEFAULT";case"usb":return"USB";default:return}}const Ce={actualAssetPresentation:"FULL",actualAudioMode:"STEREO",actualProductId:null,actualQuality:"LOSSLESS",actualStartTimestamp:0,actualStreamType:"ON_DEMAND",adaptations:[],cdm:"WIDEVINE",cdmVersion:null,endReason:"COMPLETE",endTimestamp:0,errorCode:null,errorMessage:null,hasAds:!1,idealStartTimestamp:0,outputDevice:null,productType:"TRACK",stalls:[],streamingSessionId:""},Le=await T("playback_statistics",Ce);function V(t){return Le(t)}const Ne={streamingSessionId:"",timestamp:0},Re=await T("streaming_session_end",Ne);function ze(t){return Re(t)}const De={AmazonBot:"amazonbot","Amazon Silk":"amazon_silk","Android Browser":"android",BaiduSpider:"baiduspider",Bada:"bada",BingCrawler:"bingcrawler",BlackBerry:"blackberry","ChatGPT-User":"chatgpt_user",Chrome:"chrome",ClaudeBot:"claudebot",Chromium:"chromium",Diffbot:"diffbot",DuckDuckBot:"duckduckbot",Electron:"electron",Epiphany:"epiphany",FacebookExternalHit:"facebookexternalhit",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot",GPTBot:"gptbot","Internet Explorer":"ie",InternetArchiveCrawler:"internetarchivecrawler","K-Meleon":"k_meleon",LibreWolf:"librewolf",Maxthon:"maxthon","Meta-ExternalAds":"meta_externalads","Meta-ExternalAgent":"meta_externalagent","Meta-ExternalFetcher":"meta_externalfetcher","Meta-WebIndexer":"meta_webindexer","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver","OAI-SearchBot":"oai_searchbot",Omgilibot:"omgilibot",Opera:"opera","Opera Coast":"opera_coast","Pale Moon":"pale_moon",PerplexityBot:"perplexitybot","Perplexity-User":"perplexity_user",PhantomJS:"phantomjs",PingdomBot:"pingdombot",Puffin:"puffin",QQ:"qq",QQLite:"qqlite",QupZilla:"qupzilla",Roku:"roku",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir","Sogou Browser":"sogou",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat",YahooSlurp:"yahooslurp","Yandex Browser":"yandex",YandexBot:"yandexbot",YouBot:"youbot"},Q={amazonbot:"AmazonBot",amazon_silk:"Amazon Silk",android:"Android Browser",baiduspider:"BaiduSpider",bada:"Bada",bingcrawler:"BingCrawler",blackberry:"BlackBerry",chatgpt_user:"ChatGPT-User",chrome:"Chrome",claudebot:"ClaudeBot",chromium:"Chromium",diffbot:"Diffbot",duckduckbot:"DuckDuckBot",edge:"Microsoft Edge",electron:"Electron",epiphany:"Epiphany",facebookexternalhit:"FacebookExternalHit",firefox:"Firefox",focus:"Focus",generic:"Generic",google_search:"Google Search",googlebot:"Googlebot",gptbot:"GPTBot",ie:"Internet Explorer",internetarchivecrawler:"InternetArchiveCrawler",k_meleon:"K-Meleon",librewolf:"LibreWolf",maxthon:"Maxthon",meta_externalads:"Meta-ExternalAds",meta_externalagent:"Meta-ExternalAgent",meta_externalfetcher:"Meta-ExternalFetcher",meta_webindexer:"Meta-WebIndexer",mz:"MZ Browser",naver:"NAVER Whale Browser",oai_searchbot:"OAI-SearchBot",omgilibot:"Omgilibot",opera:"Opera",opera_coast:"Opera Coast",pale_moon:"Pale Moon",perplexitybot:"PerplexityBot",perplexity_user:"Perplexity-User",phantomjs:"PhantomJS",pingdombot:"PingdomBot",puffin:"Puffin",qq:"QQ Browser",qqlite:"QQ Browser Lite",qupzilla:"QupZilla",roku:"Roku",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",sogou:"Sogou Browser",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yahooslurp:"YahooSlurp",yandex:"Yandex Browser",yandexbot:"YandexBot",youbot:"YouBot"},d={bot:"bot",desktop:"desktop",mobile:"mobile",tablet:"tablet",tv:"tv"},m={Android:"Android",Bada:"Bada",BlackBerry:"BlackBerry",ChromeOS:"Chrome OS",HarmonyOS:"HarmonyOS",iOS:"iOS",Linux:"Linux",MacOS:"macOS",PlayStation4:"PlayStation 4",Roku:"Roku",Tizen:"Tizen",WebOS:"WebOS",Windows:"Windows",WindowsPhone:"Windows Phone"},S={Blink:"Blink",EdgeHTML:"EdgeHTML",Gecko:"Gecko",Presto:"Presto",Trident:"Trident",WebKit:"WebKit"};class s{static getFirstMatch(e,r){const i=r.match(e);return i&&i.length>0&&i[1]||""}static getSecondMatch(e,r){const i=r.match(e);return i&&i.length>1&&i[2]||""}static matchAndReturnConst(e,r,i){if(e.test(r))return i}static getWindowsVersionName(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}static getMacOSVersionName(e){const r=e.split(".").splice(0,2).map(a=>parseInt(a,10)||0);r.push(0);const i=r[0],n=r[1];if(i===10)switch(n){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}switch(i){case 11:return"Big Sur";case 12:return"Monterey";case 13:return"Ventura";case 14:return"Sonoma";case 15:return"Sequoia";default:return}}static getAndroidVersionName(e){const r=e.split(".").splice(0,2).map(i=>parseInt(i,10)||0);if(r.push(0),!(r[0]===1&&r[1]<5)){if(r[0]===1&&r[1]<6)return"Cupcake";if(r[0]===1&&r[1]>=6)return"Donut";if(r[0]===2&&r[1]<2)return"Eclair";if(r[0]===2&&r[1]===2)return"Froyo";if(r[0]===2&&r[1]>2)return"Gingerbread";if(r[0]===3)return"Honeycomb";if(r[0]===4&&r[1]<1)return"Ice Cream Sandwich";if(r[0]===4&&r[1]<4)return"Jelly Bean";if(r[0]===4&&r[1]>=4)return"KitKat";if(r[0]===5)return"Lollipop";if(r[0]===6)return"Marshmallow";if(r[0]===7)return"Nougat";if(r[0]===8)return"Oreo";if(r[0]===9)return"Pie"}}static getVersionPrecision(e){return e.split(".").length}static compareVersions(e,r,i=!1){const n=s.getVersionPrecision(e),a=s.getVersionPrecision(r);let o=Math.max(n,a),u=0;const l=s.map([e,r],h=>{const y=o-s.getVersionPrecision(h),P=h+new Array(y+1).join(".0");return s.map(P.split("."),p=>new Array(20-p.length).join("0")+p).reverse()});for(i&&(u=o-Math.min(n,a)),o-=1;o>=u;){if(l[0][o]>l[1][o])return 1;if(l[0][o]===l[1][o]){if(o===u)return 0;o-=1}else if(l[0][o]<l[1][o])return-1}}static map(e,r){const i=[];let n;if(Array.prototype.map)return Array.prototype.map.call(e,r);for(n=0;n<e.length;n+=1)i.push(r(e[n]));return i}static find(e,r){let i,n;if(Array.prototype.find)return Array.prototype.find.call(e,r);for(i=0,n=e.length;i<n;i+=1){const a=e[i];if(r(a,i))return a}}static assign(e,...r){const i=e;let n,a;if(Object.assign)return Object.assign(e,...r);for(n=0,a=r.length;n<a;n+=1){const o=r[n];typeof o=="object"&&o!==null&&Object.keys(o).forEach(u=>{i[u]=o[u]})}return e}static getBrowserAlias(e){return De[e]}static getBrowserTypeByAlias(e){return Q[e]||""}}const c=/version\/(\d+(\.?_?\d+)+)/i,We=[{test:[/gptbot/i],describe(t){const e={name:"GPTBot"},r=s.getFirstMatch(/gptbot\/(\d+(\.\d+)+)/i,t)||s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/chatgpt-user/i],describe(t){const e={name:"ChatGPT-User"},r=s.getFirstMatch(/chatgpt-user\/(\d+(\.\d+)+)/i,t)||s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/oai-searchbot/i],describe(t){const e={name:"OAI-SearchBot"},r=s.getFirstMatch(/oai-searchbot\/(\d+(\.\d+)+)/i,t)||s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/claudebot/i,/claude-web/i,/claude-user/i,/claude-searchbot/i],describe(t){const e={name:"ClaudeBot"},r=s.getFirstMatch(/(?:claudebot|claude-web|claude-user|claude-searchbot)\/(\d+(\.\d+)+)/i,t)||s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/omgilibot/i,/webzio-extended/i],describe(t){const e={name:"Omgilibot"},r=s.getFirstMatch(/(?:omgilibot|webzio-extended)\/(\d+(\.\d+)+)/i,t)||s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/diffbot/i],describe(t){const e={name:"Diffbot"},r=s.getFirstMatch(/diffbot\/(\d+(\.\d+)+)/i,t)||s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/perplexitybot/i],describe(t){const e={name:"PerplexityBot"},r=s.getFirstMatch(/perplexitybot\/(\d+(\.\d+)+)/i,t)||s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/perplexity-user/i],describe(t){const e={name:"Perplexity-User"},r=s.getFirstMatch(/perplexity-user\/(\d+(\.\d+)+)/i,t)||s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/youbot/i],describe(t){const e={name:"YouBot"},r=s.getFirstMatch(/youbot\/(\d+(\.\d+)+)/i,t)||s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/meta-webindexer/i],describe(t){const e={name:"Meta-WebIndexer"},r=s.getFirstMatch(/meta-webindexer\/(\d+(\.\d+)+)/i,t)||s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/meta-externalads/i],describe(t){const e={name:"Meta-ExternalAds"},r=s.getFirstMatch(/meta-externalads\/(\d+(\.\d+)+)/i,t)||s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/meta-externalagent/i],describe(t){const e={name:"Meta-ExternalAgent"},r=s.getFirstMatch(/meta-externalagent\/(\d+(\.\d+)+)/i,t)||s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/meta-externalfetcher/i],describe(t){const e={name:"Meta-ExternalFetcher"},r=s.getFirstMatch(/meta-externalfetcher\/(\d+(\.\d+)+)/i,t)||s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/googlebot/i],describe(t){const e={name:"Googlebot"},r=s.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,t)||s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/amazonbot/i],describe(t){const e={name:"AmazonBot"},r=s.getFirstMatch(/amazonbot\/(\d+(\.\d+)+)/i,t)||s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/bingbot/i],describe(t){const e={name:"BingCrawler"},r=s.getFirstMatch(/bingbot\/(\d+(\.\d+)+)/i,t)||s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/baiduspider/i],describe(t){const e={name:"BaiduSpider"},r=s.getFirstMatch(/baiduspider\/(\d+(\.\d+)+)/i,t)||s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/duckduckbot/i],describe(t){const e={name:"DuckDuckBot"},r=s.getFirstMatch(/duckduckbot\/(\d+(\.\d+)+)/i,t)||s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/ia_archiver/i],describe(t){const e={name:"InternetArchiveCrawler"},r=s.getFirstMatch(/ia_archiver\/(\d+(\.\d+)+)/i,t)||s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/facebookexternalhit/i,/facebookcatalog/i],describe(){return{name:"FacebookExternalHit"}}},{test:[/yahoo!?[\s/]*slurp/i],describe(){return{name:"YahooSlurp"}}},{test:[/yandexbot/i,/yandexmobilebot/i],describe(){return{name:"YandexBot"}}},{test:[/pingdom/i],describe(){return{name:"PingdomBot"}}},{test:[/opera/i],describe(t){const e={name:"Opera"},r=s.getFirstMatch(c,t)||s.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/opr\/|opios/i],describe(t){const e={name:"Opera"},r=s.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,t)||s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/SamsungBrowser/i],describe(t){const e={name:"Samsung Internet for Android"},r=s.getFirstMatch(c,t)||s.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/Whale/i],describe(t){const e={name:"NAVER Whale Browser"},r=s.getFirstMatch(c,t)||s.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/PaleMoon/i],describe(t){const e={name:"Pale Moon"},r=s.getFirstMatch(c,t)||s.getFirstMatch(/(?:PaleMoon)[\s/](\d+(?:\.\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/MZBrowser/i],describe(t){const e={name:"MZ Browser"},r=s.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,t)||s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/focus/i],describe(t){const e={name:"Focus"},r=s.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,t)||s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/swing/i],describe(t){const e={name:"Swing"},r=s.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,t)||s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/coast/i],describe(t){const e={name:"Opera Coast"},r=s.getFirstMatch(c,t)||s.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe(t){const e={name:"Opera Touch"},r=s.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,t)||s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/yabrowser/i],describe(t){const e={name:"Yandex Browser"},r=s.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,t)||s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/ucbrowser/i],describe(t){const e={name:"UC Browser"},r=s.getFirstMatch(c,t)||s.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/Maxthon|mxios/i],describe(t){const e={name:"Maxthon"},r=s.getFirstMatch(c,t)||s.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/epiphany/i],describe(t){const e={name:"Epiphany"},r=s.getFirstMatch(c,t)||s.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/puffin/i],describe(t){const e={name:"Puffin"},r=s.getFirstMatch(c,t)||s.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/sleipnir/i],describe(t){const e={name:"Sleipnir"},r=s.getFirstMatch(c,t)||s.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/k-meleon/i],describe(t){const e={name:"K-Meleon"},r=s.getFirstMatch(c,t)||s.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/micromessenger/i],describe(t){const e={name:"WeChat"},r=s.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,t)||s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/qqbrowser/i],describe(t){const e={name:/qqbrowserlite/i.test(t)?"QQ Browser Lite":"QQ Browser"},r=s.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,t)||s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/msie|trident/i],describe(t){const e={name:"Internet Explorer"},r=s.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/\sedg\//i],describe(t){const e={name:"Microsoft Edge"},r=s.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/edg([ea]|ios)/i],describe(t){const e={name:"Microsoft Edge"},r=s.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/vivaldi/i],describe(t){const e={name:"Vivaldi"},r=s.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/seamonkey/i],describe(t){const e={name:"SeaMonkey"},r=s.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/sailfish/i],describe(t){const e={name:"Sailfish"},r=s.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,t);return r&&(e.version=r),e}},{test:[/silk/i],describe(t){const e={name:"Amazon Silk"},r=s.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/phantom/i],describe(t){const e={name:"PhantomJS"},r=s.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/slimerjs/i],describe(t){const e={name:"SlimerJS"},r=s.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(t){const e={name:"BlackBerry"},r=s.getFirstMatch(c,t)||s.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/(web|hpw)[o0]s/i],describe(t){const e={name:"WebOS Browser"},r=s.getFirstMatch(c,t)||s.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/bada/i],describe(t){const e={name:"Bada"},r=s.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/tizen/i],describe(t){const e={name:"Tizen"},r=s.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,t)||s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/qupzilla/i],describe(t){const e={name:"QupZilla"},r=s.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,t)||s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/librewolf/i],describe(t){const e={name:"LibreWolf"},r=s.getFirstMatch(/(?:librewolf)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/firefox|iceweasel|fxios/i],describe(t){const e={name:"Firefox"},r=s.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/electron/i],describe(t){const e={name:"Electron"},r=s.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/sogoumobilebrowser/i,/metasr/i,/se 2\.[x]/i],describe(t){const e={name:"Sogou Browser"},r=s.getFirstMatch(/(?:sogoumobilebrowser)[\s/](\d+(\.?_?\d+)+)/i,t),i=s.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),n=s.getFirstMatch(/se ([\d.]+)x/i,t),a=r||i||n;return a&&(e.version=a),e}},{test:[/MiuiBrowser/i],describe(t){const e={name:"Miui"},r=s.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/chromium/i],describe(t){const e={name:"Chromium"},r=s.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,t)||s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/chrome|crios|crmo/i],describe(t){const e={name:"Chrome"},r=s.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/GSA/i],describe(t){const e={name:"Google Search"},r=s.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test(t){const e=!t.test(/like android/i),r=t.test(/android/i);return e&&r},describe(t){const e={name:"Android Browser"},r=s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/playstation 4/i],describe(t){const e={name:"PlayStation 4"},r=s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/safari|applewebkit/i],describe(t){const e={name:"Safari"},r=s.getFirstMatch(c,t);return r&&(e.version=r),e}},{test:[/.*/i],describe(t){const e=/^(.*)\/(.*) /,r=/^(.*)\/(.*)[ \t]\((.*)/,i=t.search("\\(")!==-1?r:e;return{name:s.getFirstMatch(i,t),version:s.getSecondMatch(i,t)}}}],Ve=[{test:[/Roku\/DVP/],describe(t){const e=s.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,t);return{name:m.Roku,version:e}}},{test:[/windows phone/i],describe(t){const e=s.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,t);return{name:m.WindowsPhone,version:e}}},{test:[/windows /i],describe(t){const e=s.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,t),r=s.getWindowsVersionName(e);return{name:m.Windows,version:e,versionName:r}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(t){const e={name:m.iOS},r=s.getSecondMatch(/(Version\/)(\d[\d.]+)/,t);return r&&(e.version=r),e}},{test:[/macintosh/i],describe(t){const e=s.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,t).replace(/[_\s]/g,"."),r=s.getMacOSVersionName(e),i={name:m.MacOS,version:e};return r&&(i.versionName=r),i}},{test:[/(ipod|iphone|ipad)/i],describe(t){const e=s.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,t).replace(/[_\s]/g,".");return{name:m.iOS,version:e}}},{test:[/OpenHarmony/i],describe(t){const e=s.getFirstMatch(/OpenHarmony\s+(\d+(\.\d+)*)/i,t);return{name:m.HarmonyOS,version:e}}},{test(t){const e=!t.test(/like android/i),r=t.test(/android/i);return e&&r},describe(t){const e=s.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,t),r=s.getAndroidVersionName(e),i={name:m.Android,version:e};return r&&(i.versionName=r),i}},{test:[/(web|hpw)[o0]s/i],describe(t){const e=s.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,t),r={name:m.WebOS};return e&&e.length&&(r.version=e),r}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(t){const e=s.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,t)||s.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,t)||s.getFirstMatch(/\bbb(\d+)/i,t);return{name:m.BlackBerry,version:e}}},{test:[/bada/i],describe(t){const e=s.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,t);return{name:m.Bada,version:e}}},{test:[/tizen/i],describe(t){const e=s.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,t);return{name:m.Tizen,version:e}}},{test:[/linux/i],describe(){return{name:m.Linux}}},{test:[/CrOS/],describe(){return{name:m.ChromeOS}}},{test:[/PlayStation 4/],describe(t){const e=s.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,t);return{name:m.PlayStation4,version:e}}}],Ue=[{test:[/googlebot/i],describe(){return{type:d.bot,vendor:"Google"}}},{test:[/amazonbot/i],describe(){return{type:d.bot,vendor:"Amazon"}}},{test:[/gptbot/i],describe(){return{type:d.bot,vendor:"OpenAI"}}},{test:[/chatgpt-user/i],describe(){return{type:d.bot,vendor:"OpenAI"}}},{test:[/oai-searchbot/i],describe(){return{type:d.bot,vendor:"OpenAI"}}},{test:[/baiduspider/i],describe(){return{type:d.bot,vendor:"Baidu"}}},{test:[/bingbot/i],describe(){return{type:d.bot,vendor:"Bing"}}},{test:[/duckduckbot/i],describe(){return{type:d.bot,vendor:"DuckDuckGo"}}},{test:[/claudebot/i,/claude-web/i,/claude-user/i,/claude-searchbot/i],describe(){return{type:d.bot,vendor:"Anthropic"}}},{test:[/omgilibot/i,/webzio-extended/i],describe(){return{type:d.bot,vendor:"Webz.io"}}},{test:[/diffbot/i],describe(){return{type:d.bot,vendor:"Diffbot"}}},{test:[/perplexitybot/i],describe(){return{type:d.bot,vendor:"Perplexity AI"}}},{test:[/perplexity-user/i],describe(){return{type:d.bot,vendor:"Perplexity AI"}}},{test:[/youbot/i],describe(){return{type:d.bot,vendor:"You.com"}}},{test:[/ia_archiver/i],describe(){return{type:d.bot,vendor:"Internet Archive"}}},{test:[/meta-webindexer/i],describe(){return{type:d.bot,vendor:"Meta"}}},{test:[/meta-externalads/i],describe(){return{type:d.bot,vendor:"Meta"}}},{test:[/meta-externalagent/i],describe(){return{type:d.bot,vendor:"Meta"}}},{test:[/meta-externalfetcher/i],describe(){return{type:d.bot,vendor:"Meta"}}},{test:[/facebookexternalhit/i,/facebookcatalog/i],describe(){return{type:d.bot,vendor:"Meta"}}},{test:[/yahoo/i],describe(){return{type:d.bot,vendor:"Yahoo"}}},{test:[/yandexbot/i,/yandexmobilebot/i],describe(){return{type:d.bot,vendor:"Yandex"}}},{test:[/pingdom/i],describe(){return{type:d.bot,vendor:"Pingdom"}}},{test:[/huawei/i],describe(t){const e=s.getFirstMatch(/(can-l01)/i,t)&&"Nova",r={type:d.mobile,vendor:"Huawei"};return e&&(r.model=e),r}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe(){return{type:d.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe(){return{type:d.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(){return{type:d.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe(){return{type:d.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe(){return{type:d.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe(){return{type:d.tablet}}},{test(t){const e=t.test(/ipod|iphone/i),r=t.test(/like (ipod|iphone)/i);return e&&!r},describe(t){const e=s.getFirstMatch(/(ipod|iphone)/i,t);return{type:d.mobile,vendor:"Apple",model:e}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe(){return{type:d.mobile,vendor:"Nexus"}}},{test:[/Nokia/i],describe(t){const e=s.getFirstMatch(/Nokia\s+([0-9]+(\.[0-9]+)?)/i,t),r={type:d.mobile,vendor:"Nokia"};return e&&(r.model=e),r}},{test:[/[^-]mobi/i],describe(){return{type:d.mobile}}},{test(t){return t.getBrowserName(!0)==="blackberry"},describe(){return{type:d.mobile,vendor:"BlackBerry"}}},{test(t){return t.getBrowserName(!0)==="bada"},describe(){return{type:d.mobile}}},{test(t){return t.getBrowserName()==="windows phone"},describe(){return{type:d.mobile,vendor:"Microsoft"}}},{test(t){const e=Number(String(t.getOSVersion()).split(".")[0]);return t.getOSName(!0)==="android"&&e>=3},describe(){return{type:d.tablet}}},{test(t){return t.getOSName(!0)==="android"},describe(){return{type:d.mobile}}},{test(t){return t.getOSName(!0)==="macos"},describe(){return{type:d.desktop,vendor:"Apple"}}},{test(t){return t.getOSName(!0)==="windows"},describe(){return{type:d.desktop}}},{test(t){return t.getOSName(!0)==="linux"},describe(){return{type:d.desktop}}},{test(t){return t.getOSName(!0)==="playstation 4"},describe(){return{type:d.tv}}},{test(t){return t.getOSName(!0)==="roku"},describe(){return{type:d.tv}}}],He=[{test(t){return t.getBrowserName(!0)==="microsoft edge"},describe(t){if(/\sedg\//i.test(t))return{name:S.Blink};const e=s.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,t);return{name:S.EdgeHTML,version:e}}},{test:[/trident/i],describe(t){const e={name:S.Trident},r=s.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test(t){return t.test(/presto/i)},describe(t){const e={name:S.Presto},r=s.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test(t){const e=t.test(/gecko/i),r=t.test(/like gecko/i);return e&&!r},describe(t){const e={name:S.Gecko},r=s.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/(apple)?webkit\/537\.36/i],describe(){return{name:S.Blink}}},{test:[/(apple)?webkit/i],describe(t){const e={name:S.WebKit},r=s.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}}];class U{constructor(e,r=!1){if(e==null||e==="")throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},r!==!0&&this.parse()}getUA(){return this._ua}test(e){return e.test(this._ua)}parseBrowser(){this.parsedResult.browser={};const e=s.find(We,r=>{if(typeof r.test=="function")return r.test(this);if(Array.isArray(r.test))return r.test.some(i=>this.test(i));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.browser=e.describe(this.getUA())),this.parsedResult.browser}getBrowser(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()}getBrowserName(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""}getBrowserVersion(){return this.getBrowser().version}getOS(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()}parseOS(){this.parsedResult.os={};const e=s.find(Ve,r=>{if(typeof r.test=="function")return r.test(this);if(Array.isArray(r.test))return r.test.some(i=>this.test(i));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.os=e.describe(this.getUA())),this.parsedResult.os}getOSName(e){const{name:r}=this.getOS();return e?String(r).toLowerCase()||"":r||""}getOSVersion(){return this.getOS().version}getPlatform(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()}getPlatformType(e=!1){const{type:r}=this.getPlatform();return e?String(r).toLowerCase()||"":r||""}parsePlatform(){this.parsedResult.platform={};const e=s.find(Ue,r=>{if(typeof r.test=="function")return r.test(this);if(Array.isArray(r.test))return r.test.some(i=>this.test(i));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.platform=e.describe(this.getUA())),this.parsedResult.platform}getEngine(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()}getEngineName(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""}parseEngine(){this.parsedResult.engine={};const e=s.find(He,r=>{if(typeof r.test=="function")return r.test(this);if(Array.isArray(r.test))return r.test.some(i=>this.test(i));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.engine=e.describe(this.getUA())),this.parsedResult.engine}parse(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this}getResult(){return s.assign({},this.parsedResult)}satisfies(e){const r={};let i=0;const n={};let a=0;if(Object.keys(e).forEach(o=>{const u=e[o];typeof u=="string"?(n[o]=u,a+=1):typeof u=="object"&&(r[o]=u,i+=1)}),i>0){const o=Object.keys(r),u=s.find(o,h=>this.isOS(h));if(u){const h=this.satisfies(r[u]);if(h!==void 0)return h}const l=s.find(o,h=>this.isPlatform(h));if(l){const h=this.satisfies(r[l]);if(h!==void 0)return h}}if(a>0){const o=Object.keys(n),u=s.find(o,l=>this.isBrowser(l,!0));if(u!==void 0)return this.compareVersion(n[u])}}isBrowser(e,r=!1){const i=this.getBrowserName().toLowerCase();let n=e.toLowerCase();const a=s.getBrowserTypeByAlias(n);return r&&a&&(n=a.toLowerCase()),n===i}compareVersion(e){let r=[0],i=e,n=!1;const a=this.getBrowserVersion();if(typeof a=="string")return e[0]===">"||e[0]==="<"?(i=e.substr(1),e[1]==="="?(n=!0,i=e.substr(2)):r=[],e[0]===">"?r.push(1):r.push(-1)):e[0]==="="?i=e.substr(1):e[0]==="~"&&(n=!0,i=e.substr(1)),r.indexOf(s.compareVersions(a,i,n))>-1}isOS(e){return this.getOSName(!0)===String(e).toLowerCase()}isPlatform(e){return this.getPlatformType(!0)===String(e).toLowerCase()}isEngine(e){return this.getEngineName(!0)===String(e).toLowerCase()}is(e,r=!1){return this.isBrowser(e,r)||this.isOS(e)||this.isPlatform(e)}some(e=[]){return e.some(r=>this.is(r))}}class Ge{static getParser(e,r=!1){if(typeof e!="string")throw new Error("UserAgent should be a string");return new U(e,r)}static parse(e){return new U(e).getResult()}static get BROWSER_MAP(){return Q}static get ENGINE_MAP(){return S}static get OS_MAP(){return m}static get PLATFORMS_MAP(){return d}}const _=Ge.parse(navigator.userAgent),Qe={abTestGroup:null,abTestName:null,browser:_.browser.name??null,browserVersion:_.browser.version??null,hardwarePlatform:_.browser.name==="Electron"?"DESKTOP":"WEB",isOfflineModeStart:!1,mobileNetworkType:null,networkType:"WIFI",operatingSystem:_.os.name??null,operatingSystemVersion:_.os.version??null,screenHeight:window.screen.height,screenWidth:window.screen.width,sessionProductId:"",sessionProductType:"TRACK",sessionTags:[],sessionType:"PLAYBACK",startReason:"IMPLICIT",streamingSessionId:"",timestamp:0},qe=await T("streaming_session_start",Qe);function je(t){return qe(t)}async function Ye(t){if(await I())return t()}async function q(t){const e={consentCategory:"NECESSARY",..."extras"in t&&{extras:t.extras},group:t.group,name:t.name,payload:t.payload,version:t.version},r=e.payload.streamingSessionId;e.name==="progress"&&"streamingSessionId"in e.payload&&delete e.payload.streamingSessionId,H.eventSender.sendEvent(e),r&&await z.delete({name:e.name,streamingSessionId:r})}async function j(t){return Ye(async()=>{for(const e of t)if(e){const r=await e;r&&await q({group:"streaming_metrics",name:r.name,payload:r.payload,version:2})}})}function $e(t=!0){const e=t&&"crypto"in window&&"getRandomValues"in crypto;return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,r=>{const i=e?crypto.getRandomValues(new Uint8Array(1))[0]:Math.floor(256*Math.random());return(r^(i??0)&15>>r/4).toString(16)})}function Ke(t){return JSON.parse(atob(t))}function Je(t,e){if("codecs"in t)switch(t.codecs){case"aac":return"aac";case"aac+":return"aac+";case"flac":return"flac";case"mp3":return"mp3";case"mp4a.40.2":return"mp4a.40.2";case"mp4a.40.5":return"mp4a.40.5"}else if(e)switch(e){case"HI_RES":case"HI_RES_LOSSLESS":case"LOSSLESS":return"flac";case"HIGH":return"mp4a.40.2";case"LOW":return"mp4a.40.5"}return"none"}function Ze(t){switch(t){case"aac":case"aac+":case"mp4a.40.2":case"mp4a.40.5":return"aac";case"flac":return t;case"mp3":return"mp3";default:return}}function Xe(t){const e=/codecs=(["'])?((?:.(?!\1|>))*.?)\1?/.exec(t);if(e===null)return;const r=e[2]??"";if(r.includes("mp4a")||r.includes("aac"))return"aac";if(r==="flac")return r}function et(t){const e=/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+(?:\.\d+)?)S)?/.exec(t);if(!e)throw new Error("Invalid duration format");const r=parseFloat(e[1]||"0"),i=parseFloat(e[2]||"0"),n=parseFloat(e[3]||"0");return r*3600+i*60+n}function tt(t){const e=/mediaPresentationDuration="([^"]+)"/.exec(t);if(e){const r=e[1];if(r)return et(r)}}function rt(t){const{prefetched:e,streamingSessionId:r}=t,i="albumReplayGain"in t?{albumPeakAmplitude:t.albumPeakAmplitude,albumReplayGain:t.albumReplayGain,trackPeakAmplitude:t.trackPeakAmplitude,trackReplayGain:t.trackReplayGain}:{},n="audioQuality"in t?t.audioQuality:t.videoQuality,a={id:String("videoId"in t?t.videoId:t.trackId),type:"trackId"in t?"track":"video"};if(t.manifestMimeType===F.BTS||t.manifestMimeType===F.EMU){const o=Ke(t.manifest),u=o.urls[0],l=Je(o,"audioQuality"in t?t.audioQuality:null);let h;return"keyId"in o&&(h=o.keyId),"licenseSecurityToken"in t&&(h=t.licenseSecurityToken),{...i,bitDepth:"bitDepth"in t?t.bitDepth??void 0:void 0,codec:Ze(l),prefetched:e,quality:n,sampleRate:"sampleRate"in t?t.sampleRate??void 0:void 0,securityToken:h,streamFormat:l,streamUrl:u,streamingSessionId:r,...a,expires:t.expires}}if(t.manifestMimeType===F.DASH){const o=`data:${t.manifestMimeType};base64,${t.manifest}`,u=atob(t.manifest);return{...i,bitDepth:"bitDepth"in t?t.bitDepth??void 0:void 0,codec:Xe(u),duration:tt(u),prefetched:e,quality:n,sampleRate:"sampleRate"in t?t.sampleRate??void 0:void 0,securityToken:t.licenseSecurityToken,streamUrl:o,streamingSessionId:r,...a,expires:t.expires}}throw new TypeError(`${t.manifestMimeType} not supported as playback info manifest mime type.`)}const Y=async(t,e={},r=3)=>{let i,n;try{i=await fetch(t,e)}catch(u){if(r===0)throw u;n=null}if(i?.ok)return i;const a=i&&i.status>=500&&i.status<=599,o=n===null||a||i?.status===429;if(r>0&&o){const u=500*Math.abs(4-r);return console.debug(`Retrying request for ${Math.abs(4-r)}th time in ${u}ms`),await le(u),Y(t,e,r-1)}if(!i)throw new Error("Retries exhausted. Cannot fetch playbackinfo.");return i};function st(t,e){switch(e){case 4010:return"PEMonthlyStreamQuotaExceeded";case 4032:case 4035:return"PEContentNotAvailableInLocation";case 4033:return"PEContentNotAvailableForSubscription"}return t>=500&&t<600||t===429?"PERetryable":t>=400&&t<500?"PENotAllowed":"EUnexpected"}async function it(t){const{accessToken:e,audioQuality:r,clientId:i,mediaProduct:n,prefetch:a,streamingSessionId:o}=t,u=O("apiUrl"),l=new URL(`${u}/${n.productType}s/${n.productId}/playbackinfo`),h=l.searchParams;n.productType==="video"?h.set("videoquality","HIGH"):h.set("audioquality",r),h.set("playbackmode","STREAM"),h.set("assetpresentation","FULL");const y=new Headers;a&&y.set("x-tidal-prefetch","true"),i&&y.set("x-tidal-token",i),e&&y.set("authorization","Bearer "+e),o&&y.set("x-tidal-streamingsessionid",o);let P;try{P=await Y(l.toString(),{headers:y,importance:"high"},3)}catch{throw new B("PENetwork","NPBI0")}const p=await P.json();if("status"in p){const re=`A${p.subStatus}`;throw new B(st(p.status,p.subStatus),re)}const w="trackId"in p,te="videoId"in p;if(!w&&!te)throw new B("EUnexpected","B9999");return{...p,expires:Date.now()+36e5,prefetched:a}}async function nt(t){const{streamingSessionId:e}=t,r=[];performance.mark("streaming_metrics:playback_info_fetch:startTimestamp",{detail:e,startTime:b.now()});try{let i;if(i=await it(t),i===void 0)throw new Error("Playback info was fetched, but undefined.");L({endReason:"COMPLETE",streamingSessionId:e}).catch(console.error);const n="adInfo"in i;return"trackId"in i?V({actualAssetPresentation:i.assetPresentation,actualAudioMode:i.audioMode,actualProductId:String(i.trackId),actualQuality:i.audioQuality,actualStreamType:void 0,hasAds:n,productType:"TRACK",streamingSessionId:e}).catch(console.error):V({actualAssetPresentation:i.assetPresentation,actualAudioMode:void 0,actualProductId:String(i.videoId),actualQuality:i.videoQuality,actualStreamType:i.streamType,hasAds:n,productType:"VIDEO",streamingSessionId:e}).catch(console.error),performance.mark("streaming_metrics:playback_info_fetch:endTimestamp",{detail:e,startTime:b.now()}),i}catch(i){throw performance.mark("streaming_metrics:playback_info_fetch:endTimestamp",{detail:e,startTime:b.now()}),L({endReason:"ERROR",errorCode:i.message,errorMessage:i.stack,streamingSessionId:e}).catch(console.error),r.push(ze({streamingSessionId:e,timestamp:b.timestamp("streaming_metrics:playback_info_fetch:endTimestamp")})),i}finally{r.push(L({endTimestamp:b.timestamp("streaming_metrics:playback_info_fetch:endTimestamp"),startTimestamp:b.timestamp("streaming_metrics:playback_info_fetch:startTimestamp"),streamingSessionId:e})),j(r).catch(console.error),performance.clearMarks("streaming_metrics:playback_info_fetch:endTimestamp"),performance.clearMarks("streaming_metrics:playback_info_fetch:startTimestamp")}}class ${static#e=0;static#r=!1;static#s=null;static#t;static#i;static#n;static#a(){const{activePlayer:e}=g;e?.hasStarted()&&(this.#s=e.currentMediaProduct,this.#n=this.#d.bind(this),v.addEventListener("playback-state-change",this.#n))}static#o(){const{activePlayer:e}=g;e?.hasStarted()&&(e.playbackState!=="PLAYING"&&this.#s&&(v.dispatchEvent(new CustomEvent("load",{detail:{currentTime:this.#e,mediaProduct:this.#s}})),this.#c()),v.removeEventListener("playback-state-change",this.#n))}static#c(){this.#s=null,this.#e=0}static#d(){const{activePlayer:e}=g;e&&(this.#e=e.currentTime)}static disable(){this.#r&&(this.#t&&window.removeEventListener("offline",this.#t,!1),this.#i&&window.removeEventListener("online",this.#i,!1),this.#i=void 0,this.#t=void 0,this.#r=!1)}static enable(){this.#r||(this.#i=()=>this.#o(),this.#t=()=>this.#a(),window.addEventListener("offline",this.#t,!1),window.addEventListener("online",this.#i,!1),this.#r=!0)}}const at="streaming-privileges-revoked";function ot(t){return new CustomEvent(at,{detail:t})}let E;async function K(t){const e=O("apiUrl"),r=await fetch(e+"/rt/connect",{headers:new Headers({Authorization:"Bearer "+t,"Content-Type":"application/json"}),method:"POST"}),{url:i}=await r.json();return i}function J(t){return new Promise(e=>{t.addEventListener("open",()=>e(),{once:!0})})}class C{#e;#r;#s;#t;constructor(){this.#t=void 0,this.#r=this.#i(),v.addEventListener("user-action",()=>{this.connected&&this.userAction().then().catch(console.error)})}static async ensure(){await I()&&(E?E.connected||await E.reconnect():E=new C)}static async refresh(){if(!await I())return;const e=await W();E&&e&&E.reconnect().catch(console.error)}async#i(){const e=await W();if(!e)throw new Error("No access token to connect to Pushkin.");const r=await K(e);r&&(this.#t=new WebSocket(r),await J(this.#t),this.#s=(i=>this.#o(i.data)),this.#e=()=>this.#a(),this.#t.addEventListener("message",this.#s,!1),this.#t.addEventListener("closed",this.#e,!1),window.addEventListener("online",()=>this.#a(),{once:!0}))}async#n(e){if(!this.#t)throw new Error("No socket connected. Did you forget to call connect method in Pushkin service first?");this.#t.readyState!==WebSocket.OPEN&&await this.#r,this.#t.send(JSON.stringify(e))}#a(){this.#r=this.#i()}#o(e){const r=JSON.parse(e);switch(r.type){case"PRIVILEGED_SESSION_NOTIFICATION":{v.dispatchEvent(ot(String(r.payload.clientDisplayName))),g.activePlayer?.pause();break}case"RECONNECT":this.reconnect().catch(console.error);break;default:console.warn("Unhandled event from Pushkin: ",r);break}}reconnect(){return this.#t?(this.#s&&this.#t.removeEventListener("message",this.#s),this.#e&&this.#t.removeEventListener("closed",this.#e),this.#t.close(),this.#r=this.#i(),this.#r):Promise.resolve()}async userAction(){this.connected||await this.reconnect();try{await this.#n({payload:{startedAt:b.now()},type:"USER_ACTION"})}catch(e){console.error(e)}}get connected(){return this.#t&&this.#t.readyState===WebSocket.OPEN}}const ct=Object.freeze(Object.defineProperty({__proto__:null,Pushkin:C,fetchWebSocketURL:K,socketOpen:J},Symbol.toStringTag,{value:"Module"}));async function Z(){Pe(),$.disable(),await Me()}function bt(t,e){return t==="FULL"&&e.sourceType!=="PRIVATE_LINK_SHARING"}const dt={actions:[],actualAssetPresentation:"PREVIEW",actualAudioMode:"STEREO",actualProductId:"",actualQuality:"LOW",endAssetPosition:-1,endTimestamp:-1,isPostPaywall:!1,playbackSessionId:"",productType:"TRACK",requestedProductId:"",sourceId:"",sourceType:"",startAssetPosition:-1,startTimestamp:-1},X=await T("playback_session",dt);async function ft(t){const e=await X(t);if(!e){console.error("reducedData is undefined");return}const{name:r,streamingSessionId:i}=e,{extras:n,...a}=e.payload;return{extras:n,name:r,payload:a,streamingSessionId:i}}function yt(t,e){return X({actions:[e],streamingSessionId:t})}function wt(t){return t==="video"?"VIDEO":"TRACK"}async function vt(t){const e=await I();for(const r of t)if(r){const i=await r;i&&await q({..."extras"in i&&{extras:i.extras},group:e?"play_log":"play_log_open",name:i.name,payload:i.payload,version:2})}}async function ee(t,e=0,r=!1){if(!H.hasEventSender())throw new Error("Playback not allowed without an event sender.");if(await b.synchronize(),C.ensure().catch(console.error),g.activePlayer?.nextItem&&g.activePlayer.nextItem.mediaProduct.productId===t.productId){const w=g.activePlayer;return performance.mark("streaming_metrics:playback_statistics:idealStartTimestamp",{detail:g.preloadedStreamingSessionId,startTime:b.now()}),await w.reset({keepPreload:!0}),t.referenceId&&g.preloadedStreamingSessionId&&w.overwriteMediaProduct(g.preloadedStreamingSessionId,t),w.skipToPreloadedMediaProduct()}const i=Z(),n=$e();j([je({sessionProductId:t.productId,sessionProductType:t.productType==="track"?"TRACK":"VIDEO",sessionType:"PLAYBACK",startReason:"EXPLICIT",streamingSessionId:n,timestamp:b.now()})]).catch(console.error),performance.mark("streaming_metrics:playback_statistics:idealStartTimestamp",{detail:n,startTime:b.now()});const{clientId:a,token:o}=await M.credentialsProvider.getCredentials(),u=O("streamingWifiAudioQuality");let l=null;try{l=await nt({accessToken:o,audioQuality:u,clientId:a,mediaProduct:t,prefetch:r,streamingSessionId:n})}catch(w){w instanceof B&&v.dispatchError(w),document.location.href.includes("localhost")&&console.error(w)}if(!l)return;const h=rt(l);G.saveStreamInfo(h.streamingSessionId,h),await i,$.enable();const y="trackId"in l?l.audioQuality:void 0,P=l.manifestMimeType,p=await _e(t.productType,y,P);return ke(p),p.load({assetPosition:e,mediaProduct:t,playbackInfo:l,streamInfo:h},"explicit")}v.addEventListener("load",t=>{if(t instanceof CustomEvent){const{currentTime:e,mediaProduct:r}=t.detail;ee(r,e).then().catch(console.error)}});const ut="active-device-changed";function St(t){return new CustomEvent(ut,{detail:t})}const lt="active-device-mode-changed";function Mt(t){return new CustomEvent(lt,{detail:t})}b.synchronize().then().catch(console.error);function ht(){const t=localStorage.getItem("ssuid");try{t&&indexedDB.deleteDatabase("streaming-sessions-"+t)}catch(e){console.warn(`DB streaming-sessions-${t} could not be deleted`),console.error(e)}}ce().then().catch(console.error);ue().then().catch(console.error);ht();const kt=Object.freeze(Object.defineProperty({__proto__:null,events:v,load:ee,reset:Z},Symbol.toStringTag,{value:"Module"}));export{gt as C,B as D,vt as L,G as M,yt as N,St as Q,ee as S,j as W,pt as _,le as a,b,M as c,ze as d,wt as e,Ge as f,bt as g,g as h,kt as i,V as j,O as k,se as p,Mt as q,$e as t,ft as v,de as w,k as x,v as y};
